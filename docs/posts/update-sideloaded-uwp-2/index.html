<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="http://localhost:1313/favicon.ico" />
<title>&#39;Enabling automatic updates for sideloaded UWP apps: Multiple update channels&#39; | Muhammad Azeez</title>
<meta name="title" content="&#39;Enabling automatic updates for sideloaded UWP apps: Multiple update channels&#39;" />
<meta name="description" content="In a previous post we talked about getting more control over the update process in sideloaded UWP apps. And in another post we talked about setting up CI/CD pipelines for UWP apps. This time we will talk about how to create multiple update channels, i.e. alpha, beta, stable, for our UWP app.
The idea is very simple, and although I am going to use Azure Blob Storage, nothing stops you from using a normal web host." />
<meta name="keywords" content="uwp,devops," />


<meta property="og:url" content="http://localhost:1313/posts/update-sideloaded-uwp-2/">
  <meta property="og:site_name" content="Muhammad Azeez">
  <meta property="og:title" content="&#39;Enabling automatic updates for sideloaded UWP apps: Multiple update channels&#39;">
  <meta property="og:description" content="In a previous post we talked about getting more control over the update process in sideloaded UWP apps. And in another post we talked about setting up CI/CD pipelines for UWP apps. This time we will talk about how to create multiple update channels, i.e. alpha, beta, stable, for our UWP app.
The idea is very simple, and although I am going to use Azure Blob Storage, nothing stops you from using a normal web host.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-04-25T00:00:00+00:00">
    <meta property="article:modified_time" content="2020-04-25T00:00:00+00:00">
    <meta property="article:tag" content="Uwp">
    <meta property="article:tag" content="Devops">
    <meta property="og:image" content="http://localhost:1313/assets/images/cover.jpg">




  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/assets/images/cover.jpg">
  <meta name="twitter:title" content="&#39;Enabling automatic updates for sideloaded UWP apps: Multiple update channels&#39;">
  <meta name="twitter:description" content="In a previous post we talked about getting more control over the update process in sideloaded UWP apps. And in another post we talked about setting up CI/CD pipelines for UWP apps. This time we will talk about how to create multiple update channels, i.e. alpha, beta, stable, for our UWP app.
The idea is very simple, and although I am going to use Azure Blob Storage, nothing stops you from using a normal web host.">




  <meta itemprop="name" content="&#39;Enabling automatic updates for sideloaded UWP apps: Multiple update channels&#39;">
  <meta itemprop="description" content="In a previous post we talked about getting more control over the update process in sideloaded UWP apps. And in another post we talked about setting up CI/CD pipelines for UWP apps. This time we will talk about how to create multiple update channels, i.e. alpha, beta, stable, for our UWP app.
The idea is very simple, and although I am going to use Azure Blob Storage, nothing stops you from using a normal web host.">
  <meta itemprop="datePublished" content="2020-04-25T00:00:00+00:00">
  <meta itemprop="dateModified" content="2020-04-25T00:00:00+00:00">
  <meta itemprop="wordCount" content="883">
  <meta itemprop="image" content="http://localhost:1313/assets/images/cover.jpg">
  <meta itemprop="keywords" content="Uwp,Devops">
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  :root {
    --width: 720px;
    --font-main: Verdana, sans-serif;
    --font-secondary: Verdana, sans-serif;
    --font-scale: 1em;
    --background-color: #fff;
    --heading-color: #222;
    --text-color: #444;
    --link-color: #3273dc;
    --visited-color: #8b6fcb;
    --blockquote-color: #222;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --background-color: #01242e;
      --heading-color: #eee;
      --text-color: #ddd;
      --link-color: #8cc2dd;
      --visited-color: #8b6fcb;
      --blockquote-color: #ccc;
    }
  }

  body {
    font-family: var(--font-secondary);
    font-size: var(--font-scale);
    margin: auto;
    padding: 20px;
    max-width: var(--width);
    text-align: left;
    background-color: var(--background-color);
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: var(--text-color);
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: var(--font-main);
    color: var(--heading-color);
  }

  a {
    color: var(--link-color);
    cursor: pointer;
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  nav a {
    margin-right: 8px;
  }

  strong,
  b {
    color: var(--heading-color);
  }

  button {
    margin: 0;
    cursor: pointer;
  }

  time {
    font-family: monospace;
    font-style: normal;
    font-size: 15px;
  }

  main {
    line-height: 1.6;
  }

  table {
    width: 100%;
  }

  hr {
    border: 0;
    border-top: 1px dashed;
  }

  img {
    max-width: 100%;
  }

  code {
    font-family: monospace;
    padding: 2px;
    border-radius: 3px;
  }

  blockquote {
    border-left: 1px solid #999;
    color: var(--blockquote-color);
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px 0;
    text-align: center;
  }

  .title:hover {
    text-decoration: none;
  }

  .title h1 {
    font-size: 1.5em;
  }

  .inline {
    width: auto !important;
  }

  .highlight,
  .code {
    border-radius: 3px;
    margin-block-start: 1em;
    margin-block-end: 1em;
    overflow-x: auto;
  }

   
  ul.blog-posts {
    list-style-type: none;
    padding: unset;
  }

  ul.blog-posts li {
    display: flex;
  }

  ul.blog-posts li span {
    flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
    color: var(--visited-color);
  }

</style>
<link rel="stylesheet" href="/assets/css/highlight.css">
<link rel="stylesheet" href="/assets/css/override.css">
<script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js"></script>
</head>

<body>
  <header><div class="site-brand site-brand--inline">
  <a href="/" class="title">
    <h2>Muhammad Azeez</h2>
  </a>
  <nav class="site-nav"><a href="/">Home</a>
<a href="/about/">About</a>
</nav>
</div>
</header>
  <main>
<h1>&#39;Enabling automatic updates for sideloaded UWP apps: Multiple update channels&#39;</h1>
<p>
  <i>
    <time datetime='2020-04-25'>
      25 Apr 2020
    </time>
  </i>
</p>
<content>
  <p>In a <a href="https://mazeez.dev/posts/update-sideloaded-uwp">previous</a> post we talked about getting more control over the update process in sideloaded UWP apps. And in <a href="https://mazeez.dev/posts/uwp-devops">another post</a> we talked about setting up CI/CD pipelines for UWP apps. This time we will talk about how to create multiple update channels, i.e. alpha, beta, stable, for our UWP app.</p>
<p>The idea is very simple, and although I am going to use Azure Blob Storage, nothing stops you from using a normal web host.</p>
<h2 id="build-pipeline">Build Pipeline</h2>
<p>All of the channels should use the same build pipeline. The pipeline builds and signs the UWP. I have talked about setting up a build pipeline for UWP apps <a href="https://mazeez.dev/posts/uwp-devops">here</a>. You don&rsquo;t need to change much.</p>
<h2 id="release-pipeline">Release Pipeline</h2>
<p>All of the magic happens in the release pipeline. We can have multiple update channels by creating multiple containers in Azure DevOps (or using different prefixes, whichever you like more) for each channel.</p>
<p><img src="/assets/images/posts/update-sideloaded-uwp-2/channels.png" alt="channels"></p>
<blockquote>
<p>Note: When creating the storage account, set the the performance tier to <code>Standard</code> (<code>Premium</code> only supports <code>Page Blob</code>s) and when creating the containers set the container access level to <code>Blob</code>.</p>
</blockquote>
<p>Now for each channel, we create a stage in the release pipeline</p>
<p><img src="/assets/images/posts/update-sideloaded-uwp-2/release-stages.png" alt="release-stages"></p>
<p>Between each step we can have various approval processes or gates, Azure Pipelines makes these kinds of things incredibly easy.</p>
<p>The stages are very similar, here is what each stage has to do:</p>
<p><img src="/assets/images/posts/update-sideloaded-uwp-2/stage.png" alt="stage"></p>
<h3 id="1-change-indexhtml-and-installer-urls">1. Change index.html and .installer urls</h3>
<p>Because we now have multiple channels, each channel will have its own url. So we have to change <code>index.html</code> and the <code>.appinstaller</code> file to reflect the channels&rsquo; URL. This can be done easily via a simple PowerShell script.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#007020">Write-Host</span> <span style="color:#4070a0">&#34;Changing urls for beta channel...&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span><span style="color:#bb60d5">$oldUrl</span> = <span style="color:#4070a0">&#34;Old URL HERE&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#bb60d5">$newUrl</span> = <span style="color:#4070a0">&#34;https://YOUR-STORAGE-ACCOUNT-HERE.blob.core.windows.net/beta&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span><span style="color:#bb60d5">$folder</span> = <span style="color:#4070a0">&#34;</span>$(System.DefaultWorkingDirectory)<span style="color:#4070a0">/BUILD-ARTIFICAT-NAME/drop/AppxPackages&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span><span style="color:#bb60d5">$htmlPath</span> = <span style="color:#4070a0">&#34;</span><span style="color:#bb60d5">$folder</span><span style="color:#4070a0">/index.html&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span><span style="color:#bb60d5">$installerPath</span> = <span style="color:#4070a0">&#34;</span><span style="color:#bb60d5">$folder</span><span style="color:#4070a0">/APP-NAME.appinstaller&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>((<span style="color:#007020">Get-Content</span> -path <span style="color:#bb60d5">$htmlPath</span> -Raw) <span style="color:#666">-replace</span> <span style="color:#bb60d5">$oldUrl</span>,<span style="color:#bb60d5">$newUrl</span>) | <span style="color:#007020">Set-Content</span> -Path <span style="color:#bb60d5">$htmlPath</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>((<span style="color:#007020">Get-Content</span> -path <span style="color:#bb60d5">$installerPath</span> -Raw) <span style="color:#666">-replace</span> <span style="color:#bb60d5">$oldUrl</span>,<span style="color:#bb60d5">$newUrl</span>) | <span style="color:#007020">Set-Content</span> -Path <span style="color:#bb60d5">$installerPath</span>
</span></span></code></pre></div><h3 id="2-delete-old-versions-to-reduce-cost">2. Delete old versions to reduce cost</h3>
<p>Although Azure Blob Storage is very cheap, UWP apps can become very large, ours is about 300 MB when compiled in <code>Release</code> configuration for both <code>x64</code> and <code>x86</code> architectures. So in order to make sure we don&rsquo;t store too much data, we will delete the older versions and only leave the last N versions.</p>
<p>For this we can use the <a href="https://github.com/microsoft/azure-pipelines-tasks/blob/master/Tasks/AzureCLIV2/Readme.md">Azure CLI</a> task. It&rsquo;s similar to a Powershell script, but you&rsquo;re already logged in to your azure subscription. In the script part we can use something like this:</p>
<blockquote>
<p>Note: Azure CLI added support for PowerShell scripts in v2.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#bb60d5">$container</span> = <span style="color:#4070a0">&#34;beta&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#bb60d5">$accountName</span> = <span style="color:#4070a0">&#34;STORAGE-ACCOUNT-NAME&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#60a0b0;font-style:italic"># Get List of blobs in the container and deserialize the list</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span><span style="color:#bb60d5">$blobs</span> = az storage blob list -c <span style="color:#bb60d5">$container</span> --prefix <span style="color:#007020">APP-NAME</span>-HERE_ --account-name <span style="color:#bb60d5">$accountName</span> | <span style="color:#007020">convertFrom-json</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span><span style="color:#60a0b0;font-style:italic"># Create a HashTable so that we can store the name of the directory and its creation time</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span><span style="color:#bb60d5">$dict</span> = <span style="color:#bb60d5">@</span>{}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span><span style="color:#007020;font-weight:bold">Foreach</span>(<span style="color:#bb60d5">$blob</span> <span style="color:#007020;font-weight:bold">in</span> <span style="color:#bb60d5">$blobs</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    <span style="color:#bb60d5">$versionName</span> = <span style="color:#bb60d5">$blob</span> | <span style="color:#007020">Select-Object</span> -ExpandProperty name
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>    <span style="color:#bb60d5">$versionName</span> = <span style="color:#bb60d5">$versionName</span>.split(<span style="color:#4070a0">&#34;/&#34;</span>)[<span style="color:#40a070">0</span>]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>    <span style="color:#bb60d5">$date</span> = <span style="color:#bb60d5">$blob</span> | <span style="color:#007020">Select-Object</span> -ExpandProperty properties | <span style="color:#007020">Select-Object</span> -ExpandProperty creationTime
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>    <span style="color:#bb60d5">$date</span> = [<span style="color:#60add5">datetime</span>]<span style="color:#bb60d5">$date</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>    <span style="color:#bb60d5">$dict</span>[<span style="color:#bb60d5">$versionName</span>] = <span style="color:#bb60d5">$date</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span><span style="color:#60a0b0;font-style:italic"># Sort the directories by their creation time and skip the top 2 (we don&#39;t want to remove last 2 version)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span><span style="color:#bb60d5">$ordered</span> = <span style="color:#bb60d5">$dict</span>.GetEnumerator() | <span style="color:#007020">Sort-Object</span> -Property Value -Descending | <span style="color:#007020">Select-Object</span> -Skip <span style="color:#40a070">2</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span><span style="color:#007020">Write-Host</span> Deleting obsolete versions...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span><span style="color:#007020;font-weight:bold">Foreach</span>(<span style="color:#bb60d5">$blob</span> <span style="color:#007020;font-weight:bold">in</span> <span style="color:#bb60d5">$ordered</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span>    <span style="color:#60a0b0;font-style:italic"># APP-NAME_1.0.1.0_Test =&gt; APP-NAME_1.0.1.0_Test/*</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>    <span style="color:#bb60d5">$dir</span> = <span style="color:#bb60d5">$blob</span>.Key + <span style="color:#4070a0">&#34;/*&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span>    az storage blob <span style="color:#007020">delete-batch</span> -s <span style="color:#bb60d5">$container</span> --pattern <span style="color:#bb60d5">$dir</span> --account-name <span style="color:#bb60d5">$accountName</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span>    <span style="color:#007020">Write-Host</span> <span style="color:#bb60d5">$blob</span>.Key <span style="color:#4070a0">&#34; - &#34;</span> <span style="color:#bb60d5">$blob</span>.Value
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span><span style="color:#007020">Write-Host</span> Done
</span></span></code></pre></div><h3 id="3-copy-the-build-artifact-to-channel-container">3. Copy the build artifact to channel container</h3>
<p>We can use the amazingly fast <a href="https://github.com/microsoft/azure-pipelines-tasks/blob/master/Tasks/AzureFileCopyV1/README.md">AzureBlob File Copy</a> task to upload the build artifact to azure blob storage. Using it is straightforward, you give it a folder to upload and the name of the container as well as the subscription and it uploads the specified files in no time.</p>
<h3 id="4-optional-upload-the-uwp-symbols-to-appcenter">4. (Optional) Upload the UWP symbols to AppCenter</h3>
<p>This only needs to be done in the first stage. In order for AppCenter crashes to give you detailed stack traces, it needs the symbols to translate memory addresses to function and class names. You can find more <a href="https://docs.microsoft.com/en-us/appcenter/diagnostics/windows-support#symbolication">details here</a>.</p>
<p>I have used the <a href="https://github.com/microsoft/appcenter-cli">appcenter cli</a> to upload the symbols.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#60a0b0;font-style:italic"># AppCenter UWP symbolication</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#60a0b0;font-style:italic"># https://docs.microsoft.com/en-us/appcenter/diagnostics/windows-support#symbolication</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#60a0b0;font-style:italic"># Install appcenter cli</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span><span style="color:#60a0b0;font-style:italic"># https://github.com/microsoft/appcenter-cli</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>npm install -g <span style="color:#007020">appcenter-cli</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span><span style="color:#60a0b0;font-style:italic"># Login to AppCenter</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>appcenter login --token <span style="color:#bb60d5">$env:AppCenterToken</span> --quiet
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span><span style="color:#60a0b0;font-style:italic"># Get the path fo the symbol files (64 bit and 32 bit)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span><span style="color:#bb60d5">$symbolFiles</span> = <span style="color:#007020">Get-ChildItem</span> *.appxsym -Recurse -Force | <span style="color:#007020">Select-Object</span> -ExpandProperty FullName
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span><span style="color:#60a0b0;font-style:italic"># Upload the symbols</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span><span style="color:#007020;font-weight:bold">Foreach</span>(<span style="color:#bb60d5">$symbolFile</span> <span style="color:#007020;font-weight:bold">in</span> <span style="color:#bb60d5">$symbolFiles</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>    <span style="color:#007020">Write-Host</span> <span style="color:#4070a0">&#34;Uploading </span><span style="color:#bb60d5">$symbolFile</span><span style="color:#4070a0">...&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>    appcenter crashes <span style="color:#007020">upload-symbols</span> --app <span style="color:#007020">ORGANIZATION-NAME</span>/<span style="color:#007020">APP-NAME</span> --appxsym <span style="color:#bb60d5">$symbolFile</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>}
</span></span></code></pre></div><blockquote>
<p>Note: in the current version, appcenter cli seems to use some deprecated libraries. So I have set <code>Fail on Standard Error</code> to false on the Powershell task so that the task doesn&rsquo;t fail.</p>
<p>Note2: I am using Azure Pipelines secrets to pass the AppCenter token to appcenter cli. For that, you have to explicitly map the secret to an environment variable in the <code>Environment Variables</code> part of the Powershell task.</p>
</blockquote>
<p>Congratulations! Now you&rsquo;ve got yourself a decent multichannel auto-update process. All that remains is to teach the UWP app to look at different <code>.appinstaller</code> files based on which update channel its listening on.</p>

</content>



<p>
  
  <a href="http://localhost:1313/tags/uwp/">#uwp</a>

  
  <a href="http://localhost:1313/tags/devops/">#devops</a>

  
</p>



<section class="related-posts">
  <h3>Keep reading</h3>
  <ul>
    
    <li>
      <a href="http://localhost:1313/posts/uwp-devops/">Setting up automated build and release pipeline for side-loaded UWP apps using Azure DevOps</a>
      <span class="related-posts__date">
        27 Oct 2019
      </span>
    </li>
    
    <li>
      <a href="http://localhost:1313/posts/update-sideloaded-uwp/">Enabling automatic updates for sideloaded UWP apps</a>
      <span class="related-posts__date">
        28 Dec 2018
      </span>
    </li>
    
    <li>
      <a href="http://localhost:1313/posts/periodic-backups-potsgresql-s3-cron/">Automatic periodic backups from PostgreSQL to S3 using Cron</a>
      <span class="related-posts__date">
        29 Jan 2022
      </span>
    </li>
    
    <li>
      <a href="http://localhost:1313/posts/how-to-get-an-instance-of-a-page-when-you-navigate-to-it-in-uwp/">How to get an instance of a page when you navigate to it in UWP</a>
      <span class="related-posts__date">
        26 May 2019
      </span>
    </li>
    
  </ul>
</section>


  </main>
  <footer><div class="footer-links">
  <a href="/">Home</a> · <a href="/about/">About</a>
</div>
<div class="footer-credit">Made with <a href="https://github.com/janraasch/hugo-bearblog/">Hugo ʕ•ᴥ•ʔ Bear</a></div>
</footer>

  
</body>

</html>
